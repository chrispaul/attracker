<!DOCTYPE html>
<head>
  <style type="text/css">
    html, body { height: 100%; margin: 0; padding: 0; }
    #map { height: 60%; width: 50% }
    .wider{width: 50% }
    .narrower {width: 50% }
    .num { text-align: right; }
    .left_margin { margin-left: 15px; }
  </style>
</head>
<body>
    <h1>Hiker: {{ hiker.trail_name }} </h1>

    {% if error_message %}
        <p><strong>{{ error_message }}</strong></p>
    {% endif %}

    <table class=narrower>
        <tbody>
            <tr>
                <td>{{ hiker.miles_hiked }} miles hiked ({{ hiker.percent_hiked }}%)</td>
                <td>{{ hiker.miles_to_go }} miles remaining</td>
            </tr>
        </tbody>
    </table>
    <br>

    <div id="map" class="left_margin"></div>
    <script type="text/javascript">
        var map;
        function initMap() {

            var mid = JSON.parse('{{ mid }}');
            map = new google.maps.Map(document.getElementById('map'), {
                center: mid,
                zoom: 5,
                zoomControl: true,
                panControl: true,
            });

            var polylines = JSON.parse('{{ polylines }}');
            polylines.forEach(function(polyline) {
                var trail = new google.maps.Polyline({
                    path: polyline.coordinates,
                        geodesic: true,
                        strokeColor: polyline.color,
                        strokeOpacity: 1.0,
                        strokeWeight: 4
                    });
                trail.setMap(map);

                //Draw markers for beginning of every segment.
                var display_markers = JSON.parse('{{ display_markers }}');
                if (display_markers == 1) {
                    polyline.coordinates.forEach(function(coordinate) {
                        var marker = new google.maps.Marker({
                            position: coordinate,
                            map: map,
                            title: coordinate['lat']+' '+coordinate['lng']
                        });

                    });
                };
            });

            // Draw a point on the trail for the start of a day
            //TODO CP pass in points from Django view
            var latLng = {lat: 44.40016162702151, lng: -71.11198885103762};
            var marker = new google.maps.Marker({
                position: latLng,
                map: map,
                title: '9/8/2015 - 15 miles - Started at White Mountain Lodge & Hostel'
            });
        }
    </script>
    <script asynch defer
        src="https://maps.googleapis.com/maps/api/js?key={{google_maps_browser_key}}&callback=initMap">
    </script>

    <br>
    <div>
      <table class=wider>
        <tbody>
              <tr>
                  <td>Number of Segments: {{ hiker.number_segments }}</td>
                  <td><a href="{% url 'segment_add' hiker.id %}">Add Segment</a></td>
                  <td class=num><a href="{% url 'index' %}">Home to all Hikers</a></td>
              </tr>
        </tbody>
      </table>
    </div>
    <div id="table">
      <table border=1>
        <thead>
            <tr>
               <th>Date</th>
               <th>Start mile</th>
               <th>End mile</th>
               <th>Segment Distance</th>
               <th>Description</th>
               <th>Video</th>
               <th>Pictures</th>
               <th>Additional miles</th>
               <th>Delete segment</th>
               <th>Edit segment</th>
            </tr>
        </thead>
        <tbody>
            {% for segment in segments %}
              <tr>
                  <td>{{ segment.date }}</td>
                  <td class=num>{{ segment.start_mile }}</td>
                  <td class=num>{{ segment.end_mile }}</td>
                  <td class=num>{{ segment.distance }}</td>
                  <td>{{ segment.description }}</td>
                  <td>{{ segment.video_url }}</td>
                  <td>{{ segment.picture_url }}</td>
                  <td class=num>{{ segment.additional_miles }}</td>
                  <td><a href="{% url 'segment_delete' hiker.id segment.id %}">Delete</a></td>
                  <td><a href="{% url 'segment_edit' hiker.id segment.id %}">Edit</a></td>
              </tr>
            {% endfor %}
        </tbody>
      </table>
    </div>
    
</body>
